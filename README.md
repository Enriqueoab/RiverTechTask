# RiverTechTask

***Repository for River Tech task made by Enrique Barca***

## 1. How to run the application and tests.

### Run it without using the docker image:

- Once we have the code in our IDE, it's important to ***check for the lombok library, Intellij was able to download
  the plugin automatically in my case. We can download it and follow the steps for our IDE [HERE](https://projectlombok.org/setup/)***.
  Once we have Lombok properly install we should be able to see less errors, if any. Then we have to configure in our ***IDE the 
  run configuration, what kind of app it is, which file is the main class, etc***. Then we should be able to run the application,
  ***the DB will run in the port 3000*** keep that in mind.

#### Running the tests

- We can execute the command below from the root application folder to run all the tests in the app.

```sh

    mvn clean install

```
### Run it with docker image

- We can build the image from the docker-compose file from the root of the application folder with the command below:

```sh

    docker build -t river-tech-task:latest .

```

- Then just running the command below we should be able to use the application. Important data in the sections below.

```sh

    docker run -p 3000:3000 river-tech-task:latest

```

## 2. H2 database:

- The application is running in an in-memory database, as it was suggested in the requirements file, so the URL to visualize the console
  would be:

```

    http://localhost:3000/h2-console

```

- And, just in case, the values in the console itself should be:

  
JDBC URL:
```
jdbc:h2:file:./src/main/resources/db/RiverTechTaskDb
```
```
  User Name: sa
  Password: (Empty field)
```

## 3. Postman collection:

  - In this git repository, we should be able to see, inside the utils folder in the project root, a JSON file called
  ```Rivertech.postman_collection.json```. It contains all the endpoint, sending forms, params, pageable values.
  There is more info about the endpoints in the next section.

  We only have to open Postman and import the file ```"Collections" tab > "Import" button```


## 4. Endpoints - Documentation:

  - The application has a Swagger dependency so, when the program is running, we can visit the url below for reference id needed

```
    http://localhost:3000/swagger-ui/index.html
```

  - Or we can paste the info in the file, inside the utils folder in the project root, ```River-Tech Swagger doc.yaml```
  and go to https://editor.swagger.io/ to visualize it. 


  - #### Now a quick introduction to the endpoints and how they behave. 

    | Name                         | URL                 | What does                                                                                                      | Constrains                                                                                                                                                                        |
    |------------------------------|---------------------|----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | Player registration          | /player/register    | Register a player.                                                                                             | If the "UserName" is in the DB will throw a custom "PlayerRequestException" exception.                                                                                            |   
    | Place Bet                    | /bet                | Place a bet to the game (id) with the name and amount we want.                                                 | Once the game is executed won't accept more, throwing its exception.<br/>If the wallet balance is insufficient will throw a 402 payment required exception                        |
    | Retrieve Bet History         | /betHistory         | Return all the bets placed and/or executed thanks to the "justExecutedBets" filter in the form.                | NONE                                                                                                                                                                              |
    | Retrieve wallet transactions | /walletHistory      | Return all the transactions made by the user (place a bet) or generated by the app logic (Win a price).        | NONE                                                                                                                                                                              |
    | Execute game                 | /game/{gameId}      | Manually execute the game.<br/> ***We have 6 games in a data.sql script*** ready to get load when the app is up.| Once the game is executed we can not executed again.<br/>Once executed we can not place a bet.<br/>If the game (id) doesn't exist will return with a custom gameRequestException. |   
    | Players leader board         | /player/leaderBoard | Return a projection with the players that have got more prices.                                                | NONE                                                                                                                                                                              |   



> The "correct" flow to follow would be the same order as it is in the table above, and with a couple of players,
> some bets for each, in different games (There are 6 loaded), so the Histories, bet and transactions, would be full
> as well as the leader board.
